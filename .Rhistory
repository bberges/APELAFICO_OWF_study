geom_boxplot(position="dodge")+
theme_bw()+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0(idxDataSet)))
print(ggplot(df.plot,aes(as.factor(pairing),pos_minutes,fill=as.factor(type)))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0,20)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0(idxDataSet)))
idxPairing <- 1
CPOD.all.hour$pairing
idxPairing
df.plot <- subset(WBAT.pairwise,dataSet == idxDataSet & pairing == idxPairing)
df.plot <- df.plot[order(df.plot$type),]
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(datetime,
log10(SA),
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0.5,2.5)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0(idxDataSet,' pairing-',idxPairing)))
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0.5,2.5)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
df.plot <- subset(CPOD.all.hour,dataSet == idxDataSet & pairing == idxPairing)
df.plot <- df.plot[order(df.plot$type),]
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0.5,2.5)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,20)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,10)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
df.plot$station
df.plot$station
unique(df.plot$station)
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,10)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',unique(df.plot$station))))
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,10)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',paste(unique(df.plot$station)))))
unique(df.plot$station)
sapply(unique(df.plot$station), paste, collapse=":")
map_chr(unique(df.plot$station,paste, collapse = ":")
map_chr(unique(df.plot$station),paste, collapse = ":")
sapply(unique(df.plot$station), paste0, collapse = '-')
sapply(unique(df.plot$station), paste0, collapse = ':')
unique(df.plot$station)
paste(unique(df.plot$station),sep = ':')
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,10)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
for(idxDataSet in unique(WBAT.pairwise$dataSet)){
# WBAT
df.plot <- subset(WBAT.pairwise,dataSet == idxDataSet)
print(ggplot(df.plot,aes(as.factor(pairing),log10(SA),fill=as.factor(type)))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,2.5)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0(idxDataSet)))
# CPOD
df.plot <- subset(CPOD.all.hour,dataSet == idxDataSet)
ggplot(df.plot,aes(time_hour,pos_minutes,col=type))+
geom_line()
print(ggplot(df.plot,aes(as.factor(pairing),pos_minutes,fill=as.factor(type)))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0,20)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0(idxDataSet)))
for(idxPairing in unique(WBAT.pairwise$pairing)){
df.plot <- subset(WBAT.pairwise,dataSet == idxDataSet & pairing == idxPairing)
df.plot <- df.plot[order(df.plot$type),]
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(datetime,
log10(SA),
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0.5,2.5)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('WBAT-',idxDataSet,' pairing-',idxPairing)))
df.plot <- subset(CPOD.all.hour,dataSet == idxDataSet & pairing == idxPairing)
df.plot <- df.plot[order(df.plot$type),]
print(df.plot %>%
group_by(type) %>%
plot_seasonal_diagnostics(time_hour,
pos_minutes,
.interactive = F,
.feature_set=c('year','hour','week'))+
theme_bw()+
ylim(0,10)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
ggtitle(paste0('CPOD-',idxDataSet,' pairing-',idxPairing)))
}
}
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),fill=as.factor(type)))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_wrap(~dataSet)+
ggtitle('WBAT-all pairing'))
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),fill=as.factor(type),col=dayNight))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_wrap(~dataSet)+
ggtitle('WBAT-all pairing'))
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),col=as.factor(type),fill=dayNight))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_wrap(~dataSet)+
ggtitle('WBAT-all pairing'))
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),col=as.factor(type),group=dayNight))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_wrap(~dataSet)+
ggtitle('WBAT-all pairing'))
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),col=as.factor(type),fill=dayNight))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_wrap(~dataSet)+
ggtitle('WBAT-all pairing'))
print(ggplot(WBAT.pairwise,aes(as.factor(pairing),log10(SA),col=as.factor(type)))+
geom_boxplot(position="dodge")+
theme_bw()+
ylim(0.5,3)+
xlab('Pairing')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
facet_grid(dayNight~dataSet)+
ggtitle('WBAT-all pairing'))
############################################################################
# CPOD/SA correlation
############################################################################
WBAT.all.summary$time_hour <- as.POSIXct(cut(WBAT.all.summary$datetime, breaks = "1 hour"),tz='UTC')
df.all <- left_join(subset(WBAT.all.summary,treshold == -50 & frequency == 70),CPOD.all.hour,by=c('stationSet','time_hour'))
df.all
colnames(WBAT.all.summary)
colnames(CPOD.all.hour)
WBAT.all.summary$WBAT_70
WBAT.all.summary$WBAT_200
colnames(CPOD.all.hour)
colnames(WBAT.all.summary)
CPOD.all.hour$pairingName
colnames(CPOD.all.hour)
df.all <- left_join(subset(WBAT.all.summary,treshold == -50 & frequency == 70),CPOD.all.hour,by=c('stationSet',
'stationName',
'dataSet',
'dayNight',
'pairing',
'time_hour'))
df.all <- left_join(subset(WBAT.all.summary,treshold == -50 & frequency == 70),CPOD.all.hour,by=c('stationSet',
'station',
'dataSet',
'dayNight',
'pairing',
'time_hour'))
df.all$pairing
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,type=type))+
geom_point()
df.all <- left_join(subset(WBAT.all.summary,treshold == -50 & frequency == 70),CPOD.all.hour,by=c('stationSet',
'station',
'type',
'dataSet',
'dayNight',
'pairing',
'time_hour'))
View(df.all)
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.all.summary$datetime, breaks = "1 hour"),tz='UTC')
library(ggplot2)
library(tidyverse)
library(lubridate)
library(icesTAF)
library(timetk)
rm(list=ls())
#setwd('D:/PAM_RABO/finless_neonate_HK')
setwd('D:/git/APELAFICO_OWF_study/')
#setwd('G:/git/WBAT_APELAFICO')
sourceDir(file.path('.','function'))
figurePath    <- file.path('.','figures')
dataPath      <- file.path('.','data')
resultPath    <- file.path('.','results')
WBAT.tab <- read.csv(file.path(dataPath,'survey_db.csv'))
WBAT.tab <- WBAT.tab[,c(1:5,8,9)]
WBAT.tab$dataSet_station <- paste0(WBAT.tab$dataSet,'_',WBAT.tab$station)
overview.tab <- read.csv(file.path(dataPath,'data_overview.csv'))
overview.tab$stationSet <- paste0(overview.tab$dataSet,'_',overview.tab$station)
overview.tab$pairingName <- paste0(overview.tab$dataSet,'_',overview.tab$pairing)
overview.tab <- overview.tab %>% select(-c('year','dataSet','station'))
load(file = file.path(resultPath,'CPOD_WBAT_workspace.RData'))
# adjust CPOD data frames (should be done at data generation...)
CPOD.all.day$station <- CPOD.all.day$stationName
CPOD.all.day$stationSet <- paste0(CPOD.all.day$dataSet,'_',CPOD.all.day$station)
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.day <- CPOD.all.day %>% select(-c('lat','lon'))
CPOD.all.day <- left_join(CPOD.all.day,overview.tab,by=c('stationSet'))
CPOD.all.day <- subset(CPOD.all.day,pairing != -1)
CPOD.all.hour$station <- CPOD.all.hour$stationName
CPOD.all.hour$stationSet <- paste0(CPOD.all.hour$dataSet,'_',CPOD.all.hour$station)
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.hour <- CPOD.all.hour %>% select(-c('lat','lon'))
CPOD.all.hour <- left_join(CPOD.all.hour,overview.tab,by=c('stationSet'))
CPOD.all.hour <- subset(CPOD.all.hour,pairing != -1)
CPOD.all.min$station <- CPOD.all.min$stationName
CPOD.all.min$stationSet <- paste0(CPOD.all.min$dataSet,'_',CPOD.all.min$station)
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.min <- CPOD.all.min %>% select(-c('lat','lon'))
CPOD.all.min <- left_join(CPOD.all.min,overview.tab,by=c('stationSet'))
CPOD.all.min <- subset(CPOD.all.min,pairing != -1)
############################################################################
# pairwise comparison
############################################################################
WBAT.pairwise <- subset(WBAT.all.summary,pairing != -1 & n >= 9 & treshold == -50 & frequency == 70 & depthIntegration > 5)
WBAT.pairwise$type <- factor(WBAT.pairwise$type,levels = c("OWF","out","wreck"))
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.all.summary$datetime, breaks = "1 hour"),tz='UTC')
library(ggplot2)
library(tidyverse)
library(lubridate)
library(icesTAF)
library(timetk)
rm(list=ls())
#setwd('D:/PAM_RABO/finless_neonate_HK')
setwd('D:/git/APELAFICO_OWF_study/')
#setwd('G:/git/WBAT_APELAFICO')
sourceDir(file.path('.','function'))
figurePath    <- file.path('.','figures')
dataPath      <- file.path('.','data')
resultPath    <- file.path('.','results')
WBAT.tab <- read.csv(file.path(dataPath,'survey_db.csv'))
WBAT.tab <- WBAT.tab[,c(1:5,8,9)]
WBAT.tab$dataSet_station <- paste0(WBAT.tab$dataSet,'_',WBAT.tab$station)
overview.tab <- read.csv(file.path(dataPath,'data_overview.csv'))
overview.tab$stationSet <- paste0(overview.tab$dataSet,'_',overview.tab$station)
overview.tab$pairingName <- paste0(overview.tab$dataSet,'_',overview.tab$pairing)
overview.tab <- overview.tab %>% select(-c('year','dataSet','station'))
load(file = file.path(resultPath,'CPOD_WBAT_workspace.RData'))
# adjust CPOD data frames (should be done at data generation...)
CPOD.all.day$station <- CPOD.all.day$stationName
CPOD.all.day$stationSet <- paste0(CPOD.all.day$dataSet,'_',CPOD.all.day$station)
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.day <- CPOD.all.day %>% select(-c('lat','lon'))
CPOD.all.day <- left_join(CPOD.all.day,overview.tab,by=c('stationSet'))
CPOD.all.day <- subset(CPOD.all.day,pairing != -1)
CPOD.all.hour$station <- CPOD.all.hour$stationName
CPOD.all.hour$stationSet <- paste0(CPOD.all.hour$dataSet,'_',CPOD.all.hour$station)
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.hour <- CPOD.all.hour %>% select(-c('lat','lon'))
CPOD.all.hour <- left_join(CPOD.all.hour,overview.tab,by=c('stationSet'))
CPOD.all.hour <- subset(CPOD.all.hour,pairing != -1)
CPOD.all.min$station <- CPOD.all.min$stationName
CPOD.all.min$stationSet <- paste0(CPOD.all.min$dataSet,'_',CPOD.all.min$station)
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.min <- CPOD.all.min %>% select(-c('lat','lon'))
CPOD.all.min <- left_join(CPOD.all.min,overview.tab,by=c('stationSet'))
CPOD.all.min <- subset(CPOD.all.min,pairing != -1)
WBAT.pairwise <- subset(WBAT.all.summary,pairing != -1 & n >= 9 & treshold == -50 & frequency == 70 & depthIntegration > 5)
WBAT.pairwise$type <- factor(WBAT.pairwise$type,levels = c("OWF","out","wreck"))
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 hour"),tz='UTC')
CPOD.all.min$type <- factor(CPOD.all.min$type,levels = c("OWF","out","wreck"))
CPOD.all.hour$type <- factor(CPOD.all.hour$type,levels = c("OWF","out","wreck"))
CPOD.all.day$type <- factor(CPOD.all.day$type,levels = c("OWF","out","wreck"))
############################################################################
# CPOD/SA correlation
############################################################################
df.all <- left_join(WBAT.pairwise,CPOD.all.hour,by=c('stationSet',
'station',
'type',
'dataSet',
'dayNight',
'pairing',
'time_hour'))
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,type=type))+
geom_point()
df.all$type
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,shape=type))+
geom_point()
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,shape=type))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,shape=type,group=type))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,shape=type,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
df.all
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),shape=type,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),shape=type,col=dataSet,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
unique(df.all$dataSet)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),shape=type,col=dataSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),shape=type,col=dataSet))+
#stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
geom_point()
unique(CPOD.all.hour$station)
############################################################################
# CPOD/SA correlation
############################################################################
df.all <- left_join(WBAT.pairwise,CPOD.all.hour,by=c('stationSet',
'type',
'dataSet',
'dayNight',
'pairing',
'time_hour'))
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),shape=type,col=dataSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),col=type,shape=dataSet,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=log10(SA),y=pos_minutes,col=type,shape=dataSet,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),col=type,shape=dataSet,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)
ggplot(df.all,aes(x=pos_minutes,y=log10(SA),col=type,shape=dataSet,group=stationSet))+
stat_summary(fun.data=mean_se, geom="pointrange", na.rm = TRUE)+
facet_wrap(~dayNight)
df.all$day
df.all$dayNight
subset(df.all,dayNight == 'day')
temp <- subset(df.all,dayNight == 'day')
View(temp)
CPOD.all.hour$time_hour
############################################################################
# CPOD/SA correlation
############################################################################
df.all <- left_join(WBAT.pairwise,CPOD.all.hour,by=c('stationSet',
'type',
'dataSet',
'pairing',
'time_hour'))
temp <- subset(df.all,dayNight == 'day')
temp <- subset(df.all,dayNight.x == 'day')
View(temp)
temp$time_hour
View(CPOD.all.hour)
CPOD.all.hour$time_hour
WBAT.pairwise$time_hour
CPOD.all.hour$time_hour <- as.POSIXct(cut(CPOD.all.hour$time_hour, breaks = "1 hour"),tz='UTC')
CPOD.all.hour$time_hour
CPOD.all.hour$time_hour[1]
CPOD.all.hour$time_hour[2]
CPOD.all.hour$time_hour[3]
library(ggplot2)
library(tidyverse)
library(lubridate)
library(icesTAF)
library(timetk)
rm(list=ls())
#setwd('D:/PAM_RABO/finless_neonate_HK')
setwd('D:/git/APELAFICO_OWF_study/')
#setwd('G:/git/WBAT_APELAFICO')
sourceDir(file.path('.','function'))
figurePath    <- file.path('.','figures')
dataPath      <- file.path('.','data')
resultPath    <- file.path('.','results')
WBAT.tab <- read.csv(file.path(dataPath,'survey_db.csv'))
WBAT.tab <- WBAT.tab[,c(1:5,8,9)]
WBAT.tab$dataSet_station <- paste0(WBAT.tab$dataSet,'_',WBAT.tab$station)
overview.tab <- read.csv(file.path(dataPath,'data_overview.csv'))
overview.tab$stationSet <- paste0(overview.tab$dataSet,'_',overview.tab$station)
overview.tab$pairingName <- paste0(overview.tab$dataSet,'_',overview.tab$pairing)
overview.tab <- overview.tab %>% select(-c('year','dataSet','station'))
load(file = file.path(resultPath,'CPOD_WBAT_workspace.RData'))
# adjust CPOD data frames (should be done at data generation...)
CPOD.all.day$station <- CPOD.all.day$stationName
CPOD.all.day$stationSet <- paste0(CPOD.all.day$dataSet,'_',CPOD.all.day$station)
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.day$stationSet[CPOD.all.day$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.day <- CPOD.all.day %>% select(-c('lat','lon'))
CPOD.all.day <- left_join(CPOD.all.day,overview.tab,by=c('stationSet'))
CPOD.all.day <- subset(CPOD.all.day,pairing != -1)
CPOD.all.hour$station <- CPOD.all.hour$stationName
CPOD.all.hour$stationSet <- paste0(CPOD.all.hour$dataSet,'_',CPOD.all.hour$station)
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.hour$stationSet[CPOD.all.hour$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.hour <- CPOD.all.hour %>% select(-c('lat','lon'))
CPOD.all.hour <- left_join(CPOD.all.hour,overview.tab,by=c('stationSet'))
CPOD.all.hour <- subset(CPOD.all.hour,pairing != -1)
CPOD.all.min$station <- CPOD.all.min$stationName
CPOD.all.min$stationSet <- paste0(CPOD.all.min$dataSet,'_',CPOD.all.min$station)
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_274174"] <- "2023-BSW_274174 BSW1"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_278093"] <- "2023-BSW_278093 BSW2"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267814"] <- "2023-BSW_267814 BSW3"
CPOD.all.min$stationSet[CPOD.all.min$stationSet == "2023-BSW_267838"] <- "2023-BSW_267838 BSW4"
CPOD.all.min <- CPOD.all.min %>% select(-c('lat','lon'))
CPOD.all.min <- left_join(CPOD.all.min,overview.tab,by=c('stationSet'))
CPOD.all.min <- subset(CPOD.all.min,pairing != -1)
WBAT.pairwise <- subset(WBAT.all.summary,pairing != -1 & n >= 9 & treshold == -50 & frequency == 70 & depthIntegration > 5)
WBAT.pairwise$type <- factor(WBAT.pairwise$type,levels = c("OWF","out","wreck"))
?cut
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 h"),tz='UTC')
WBAT.pairwise$time_hour
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 minute"),tz='UTC')
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 minutes"),tz='UTC')
WBAT.pairwise$time_hour <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 min"),tz='UTC')
WBAT.pairwise$time_hour[1]
temp <- cut(WBAT.pairwise$datetime, breaks = "1 min")
temp[1]
as.POSIXct(temp[1])
as.POSIXct(temp[1],tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1], breaks = "1 min"),tz='UTC')
temp <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 min"),tz='UTC')
temp[1]
temp <- as.POSIXct(cut(as.POSIXct(WBAT.pairwise$datetime,tz='UTC'), breaks = "1 min"),tz='UTC')
temp[1]
temp <- as.POSIXct(cut(WBAT.pairwise$datetime, breaks = "1 hour"),tz='UTC')
temp[1]
as.POSIXct(cut(WBAT.pairwise$datetime[1], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[length(WBAT.pairwise$datetime)], breaks = "1 hour"),tz='UTC')
View(WBAT.pairwise)
as.POSIXct(cut(WBAT.pairwise$datetime[1:20], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1:2], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1:10], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1:5], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1:6], breaks = "1 hour"),tz='UTC')
as.POSIXct(cut(WBAT.pairwise$datetime[1:7], breaks = "1 hour"),tz='UTC')
WBAT.pairwise$datetime[7]
